<a href="https://github.com/git2RDFLab/"><img align="right" role="right" height="96" src="https://github.com/git2RDFLab/.github/blob/main/profile/images/GitLotus-logo.png?raw=true" style="height: 96px;z-index: 1000000" title="GitLotus" alt="GitLotus"/></a>

# GitLotus Component: Web service for scheduling conversion of Git repositories to RDF data sets

The component is available as a Docker image [superdose/git2rdf-worker-service](https://hub.docker.com/r/superdose/git2rdf-worker-service/tags).
See the repository [project-deployment-compose](https://github.com/git2RDFLab/project-deployment-compose/tree/main) for a prepared Docker container starting and configuration script.

## Build and execution environment

The [Spring Boot](https://spring.io/projects/spring-boot) service can be created using [Apache Maven](https://maven.apache.org/).

```ShellSession
git clone git@github.com:git2RDFLab/ccr-worker-prototype.git
cd database-shared-common
mvn package
```

```DockerImage
docker build -t git2rdf-worker-service:1.0.0 .

```

See the folder `target` for the executable JAR file.

**Dependency notice:** To remove duplicate database [JPA](https://spring.io/projects/spring-data-jpa) definitions, a shared database commons project was introduced. See [database-shared-common](https://github.com/git2RDFLab/database-shared-common/) for installing this GitLotus-specific dependency.

## Environment Variables

| Environment Variables                        | Description                                                                                                                                                                                                                                                                                                                                 |
|----------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `SPRING_DATASOURCE_URL`                        | The fully qualified URL to the database. Expects the database connection string as of the defined schema by the used database. This project expects per default a PostgreSQL database. A default value is given for local deployments.                                                                                                       |
| `SPRING_DATASOURCE_PASSWORD`                   | The password of the database. A default value is given for local deployments.                                                                                                                                                                                                                                                               |
| `WORKER_TASK_RDFGITREPO_ENABLED`               | Whether the scheduler, which is responsible for converting Git repos to rdf files, should be enabled. The default is true.                                                                                                                                                                                                                      |
| `WORKER_TASK_RDFGITHUBREPO_ENABLED`            | Whether the scheduler, which is responsible for converting GitHub repos to rdf files, should be enabled. The default is true.                                                                                                                                                                                                                   |
| `GITHUB_LOGIN_KEY`                             | The private pem-base64-key generated by your GitHub app. Env-Var should only contain the base64. Remove the Key-Type declarations and line breaks. Will be used to sign JWT tokens. [More information](https://docs.github.com/en/apps/creating-github-apps/authenticating-with-a-github-app/managing-private-keys-for-github-apps). |
| `GITHUB_LOGIN_APP_ID`                          | The ID of your GitHub app, which you use for authentication to GitHub. The ID can be retrieved from the user -> settings -> developer settings -> (GitHub app) menu. [More information](https://docs.github.com/en/apps/creating-github-apps/authenticating-with-a-github-app/generating-a-json-web-token-jwt-for-a-github-app).     |
| `GITHUB_LOGIN_APP_INSTALLATION_ID`             | The installation ID of your GitHub app, which you use for authentication to GitHub. The id can be retrieved for example via 'GET /users/{username}/installation'. [More information](https://docs.github.com/en/apps/creating-github-apps/authenticating-with-a-github-app/authenticating-as-a-github-app-installation).             |
| `GITHUB_LOGIN_SYSTEM_USER_NAME`                | Your GitHub login username. Is used in combination with your personal access token to pull Git repositories from GitHub.                                                                                                                                                                                                                           |
| `GITHUB_LOGIN_SYSTEM_USER_PERSONALACCESSTOKEN` | A personal access token for your GitHub user. Is used in combination with your username to pull Git repositories from GitHub.                                                                                                                                                                                                                      |

## Discussion containers

Reviews expose their comments via a dedicated container located at `#comments` relative to the parent resource. The parent links to this container via `github:discussion`. The container is typed as `rdf:Bag` and enumerates comment URIs using ordinal properties like `rdf:_1`, `rdf:_2`.

[Spring Initializr Template](https://start.spring.io/#!type=maven-project&language=java&platformVersion=3.2.2&packaging=jar&jvmVersion=21&groupId=de.leipzig.htwk.gitrdf&artifactId=worker&name=worker&description=Archetype%20project%20for%20HTWK%20Leipzig%20-%20Project%20to%20transform%20git%20to%20RDF&packageName=de.leipzig.htwk.gitrdf.worker&dependencies=lombok,devtools,data-jpa,postgresql,testcontainers,integration)

[New Spring Initializr Template](https://start.spring.io/#!type=maven-project&language=java&platformVersion=3.2.2&packaging=jar&jvmVersion=21&groupId=de.leipzig.htwk.gitrdf&artifactId=worker&name=worker&description=Archetype%20project%20for%20HTWK%20Leipzig%20-%20Project%20to%20transform%20git%20to%20RDF&packageName=de.leipzig.htwk.gitrdf.worker&dependencies=lombok,devtools,data-jpa,postgresql,testcontainers,integration,flyway)


## Review List Example

Pull request reviews are now collected in a simple list resource.

```turtle
<#pr123> github:reviews <#pr123/reviews> .

<#pr123/reviews>
    rdf:_1 <#pr123/reviews/1> ;
    rdf:_2 <#pr123/reviews/2> .
```


## Contribute

We are happy to receive your contributions. 
Please create a pull request or an issue. 
As this tool is published under the MIT license, feel free to fork it and use it in your own projects.

## Disclaimer

This tool just temporarily stores the image data. 
It is provided "as is" and without any warranty, express or implied.

